import json
import requests

apiDict = dict(Ош="Ош", Актау="кта", Актобе="обе", Алматы="лма", Бишкек="ишк", Владикавказ="кав", Владивосток="ток"\
                 , Днепр="епр", Красноярск="ояр", Магнитогорск="тог", Москва="ква", НижнийНовгород="Ниж"\
                 , Новосибирск="сиб", Омск="мск", Орёл="рёл", ПетропавловскКамчатский="кий"\
                 , СанктПетербург="ург", Томск="том", УстьКаменогорск="Уст", Уфа="Уфа", Орел="рел")
# Словарь для запросов к API

realDict = dict(Ош="Ош", Актау="Актау", Актобе="Актобе", Алматы="Алматы", Бишкек="Бишкек", Владикавказ="Владикавказ"\
                , Владивосток="Владивосток", Днепр="Днепр", Красноярск="Красноярск", Магнитогорск="Магнитогорск"\
                , Москва="Москва", НижнийНовгород="Нижний Новгород", Новосибирск="Новосибирск", Омск="Омск"\
                , Орёл="Орёл", ПетропавловскКамчатский="Петропавловск-Камчатский"\
                , СанктПетербург="Санкт-Петербург", Томск="Томск", УстьКаменогорск="Усть-Каменогорск", Уфа="Уфа"\
                , Орел="Орел")
# Словарь с тем, что должно отдать API

x = 0
z = 0
for i in apiDict: # цикл, в котором есть запрос с каждым городом в API
    x = i
    q = (apiDict[x]) # значение q подставляется в конец запроса к API
    needUrl = 'https://regions-test.2gis.com/1.0/regions?q=' + q # ссылка для запроса к API
    response = requests.get(needUrl) # get запрос к API
    answer = json.loads(response.text) # считываем строку в формате JSON и возвращаем объект в Python. Это ответ API
    errorValue1 = 'error'
    errorValue2 = str(answer) # делаем строковую переменную, равную answer, для дальнейшего сравнения
    if errorValue1 in errorValue2: # если в ответе есть сообщение об ошибке
        cityName = realDict[x] # присваиваем переменной значение из словаря, при котором произошла ошибка
        print("При запросе", apiDict[x], "город", cityName, "отсутствует в ответе API - test FAILED")
    elif errorValue1 not in errorValue2:
        test = answer['items'] # получаем ответ от API
        j = str(test) # делаем его строкой, чтобы сравнить
        y = realDict[x] # то, что дожлно отдать API
        if y in j:
            print("При запросе", apiDict[x], "город", y, "есть в ответе API:", j, "- test PASSED")
        else:
            print("При запросе", apiDict[x], "город", y, "отсутствует в ответе API:", j, "- test FAILED")
